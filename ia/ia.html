<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev.IA</title>
    <!-- CSS -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="../estilos/ia.css">
    <link rel="stylesheet" href="../estilos/style.css">
    <link rel="stylesheet" href="../estilos/media-query.css">
    <link rel="stylesheet" href="../animation/animation.css">
</head>
<body>
    <div class="chatbot">
      <header>
        <div id="typing-text"></div>
        <span id="blinking-cursor">_</span>
        <i id="burguer" class="material-icons" onclick="clickMenu()">menu</i>
      <menu id="itens">
      <ul class="menu">
        <li><a href="../index.html">Home</a></li>
        <li><a href="../news/news.html">News</a></li>
        <li><a href="../games/games.html">Games</a></li>
        <li><a href="#">IA</a></li>
        <li><a href="../chat/chat.html">Chat</a></li>
        <li><a href="login-cadastro/login-cadastro.html">Login | Cadastro</a></li>
      </ul>
    </menu>
      </header>
      <main>
        <ul class="chatbox">
          <li class="chat incoming">
            <span class="material-symbols-outlined">dev.ia</span>
            <p>Hi there <br>How can I help you today?</p>
          </li>
        </ul>
        <div class="chat-input">
          <textarea placeholder="Enter a message..." spellcheck="false" required></textarea>
          <span><button id="send-btn" class="material-symbols-rounded">send</button></span>
        </div>
            </div>
      </main>
    <footer>
      <p>Criado por <a href="https://github.com/DevSpector" title="Spector" target="_blank">Eliel Andre de Queiroz.</a></p>
    </footer>
<script src="../script/script.js"></script>
<script src="script/animation.js"></script>
<script>
  const text = "Dev.IA"; // Texto do título
        const typingText = document.getElementById("typing-text");
        const cursor = document.getElementById("blinking-cursor");

        let i = 0;

        function typeWriter() {
            if (i < text.length) {
                typingText.textContent += text.charAt(i);
                i++;
                setTimeout(typeWriter, 150); // Velocidade (150ms)
            } else {
                cursor.style.opacity = "1"; // Mostra o cursor ao finalizar
            }
        }

        // Inicia após 500ms (ajuste conforme necessário)
        setTimeout(typeWriter, 500);
</script>
<script>
const chatbox = document.querySelector(".chatbox");
      const chatInput = document.querySelector(".chat-input textarea");
      const sendChatBtn = document.querySelector(".chat-input span");
      let userMessage = null; // Variable to store user's message
      const inputInitHeight = chatInput.scrollHeight;
      // API configuration
      const API_KEY = "AIzaSyACm1vgMXA8CR5b92o79W-bUoEMjQi4Aa4"; // Your API key here
      const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
      const createChatLi = (message, className) => {
        // Create a chat <li> element with passed message and className
        const chatLi = document.createElement("li");
        chatLi.classList.add("chat", `${className}`);
        let chatContent = className === "outgoing" ? `<p></p>` : `<span class="material-symbols-outlined">dev.ia</span><p></p>`;
        chatLi.innerHTML = chatContent;
        chatLi.querySelector("p").textContent = message;
        return chatLi; // return chat <li> element
      }
      const generateResponse = async (chatElement) => {
        const messageElement = chatElement.querySelector("p");
        // Define the properties and message for the API request
        const requestOptions = {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ 
            contents: [{ 
              role: "user", 
              parts: [{ text: userMessage }] 
            }] 
          }),
        }
        // Send POST request to API, get response and set the reponse as paragraph text
        try {
          const response = await fetch(API_URL, requestOptions);
          const data = await response.json();
          if (!response.ok) throw new Error(data.error.message);
          
          // Get the API response text and update the message element
          messageElement.textContent = data.candidates[0].content.parts[0].text.replace(/\*\*(.*?)\*\*/g, '$1');
        } catch (error) {
          // Handle error
          messageElement.classList.add("error");
          messageElement.textContent = error.message;
        } finally {
          chatbox.scrollTo(0, chatbox.scrollHeight);
        }
      }
      const handleChat = () => {
        userMessage = chatInput.value.trim(); // Get user entered message and remove extra whitespace
        if (!userMessage) return;
        // Clear the input textarea and set its height to default
        chatInput.value = "";
        chatInput.style.height = `${inputInitHeight}px`;
        // Append the user's message to the chatbox
        chatbox.appendChild(createChatLi(userMessage, "outgoing"));
        chatbox.scrollTo(0, chatbox.scrollHeight);
        setTimeout(() => {
          // Display "Thinking..." message while waiting for the response
          const incomingChatLi = createChatLi("Thinking...", "incoming");
          chatbox.appendChild(incomingChatLi);
          chatbox.scrollTo(0, chatbox.scrollHeight);
          generateResponse(incomingChatLi);
        }, 600);
      }
      chatInput.addEventListener("input", () => {
        // Adjust the height of the input textarea based on its content
        chatInput.style.height = `${inputInitHeight}px`;
        chatInput.style.height = `${chatInput.scrollHeight}px`;
      });
      chatInput.addEventListener("keydown", (e) => {
        // If Enter key is pressed without Shift key and the window 
        // width is greater than 800px, handle the chat
        if (e.key === "Enter" && !e.shiftKey && window.innerWidth > 800) {
          e.preventDefault();
          handleChat();
        }
      });
      sendChatBtn.addEventListener("click", handleChat);
      closeBtn.addEventListener("click", () => document.body.classList.remove("show-chatbot"));
      chatbotToggler.addEventListener("click", () => document.body.classList.toggle("show-chatbot"));
</script>
</body>
</html>